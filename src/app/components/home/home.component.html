<!-- Header -->
<header class="header">
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3v18h18"/>
          <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
        </svg>
      </div>
      <div class="logo-text">
        <h1>AuroBi</h1>
        <span class="tagline">Business Intelligence Platform</span>
      </div>
    </div>
    <div class="header-actions">
      <div class="connection-status" [ngClass]="{'connected': isConnected, 'disconnected': !isConnected}">
        <span class="status-indicator"></span>
        <span>{{ connectionStatus || 'Not connected' }}</span>
      </div>
      <button class="connect-btn" (click)="openConnectionModal()" [class.connected]="isConnected">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 6h.01M6 18h.01m12-12h.01M18 18h.01M6 6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h2zM18 6a2 2 0 012 2v8a2 2 0 01-2 2h-2a2 2 0 01-2-2V8a2 2 0 012-2h2zM8 12h8"/>
        </svg>
        {{ isConnected ? 'Connected' : 'Connect Data Source' }}
      </button>
    </div>
  </div>
</header>

<!-- Main Layout -->
<div class="main-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <div class="nav-section">
        <h4>Data Management</h4>
        <ul class="nav-list">
          <li class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="setActiveTab('dashboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <path d="M9 9h6v6H9z"/>
            </svg>
            <span>Dashboard</span>
          </li>
          <li class="nav-item" [class.active]="activeTab === 'metadata'" [class.disabled]="!isConnected" (click)="setActiveTab('metadata')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            <span>Metadata</span>
          </li>
          <li class="nav-item" [class.active]="activeTab === 'tables'" [class.disabled]="!isConnected" (click)="setActiveTab('tables')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
            </svg>
            <span>Tables</span>
          </li>
          <li class="nav-item" [class.active]="activeTab === 'query'" [class.disabled]="!isConnected" (click)="setActiveTab('query')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
            <span>Query Builder</span>
          </li>
        </ul>
      </div>
      
      <div class="nav-section">
        <h4>Tools</h4>
        <ul class="nav-list">
          <li class="nav-item" (click)="downloadTemplate()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>Excel Template</span>
          </li>
          <li class="nav-item" (click)="debugConnection()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/>
            </svg>
            <span>Debug Info</span>
          </li>
        </ul>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-area">
      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="loading-overlay">
        <div class="loading-spinner">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"/>
          </svg>
        </div>
        <span>Loading...</span>
      </div>

      <!-- Dashboard Tab -->
      <div *ngIf="activeTab === 'dashboard'" class="tab-content">
        <div class="dashboard">
          <div class="welcome-card">
            <h2>Welcome to AuroBi</h2>
            <p>Connect to your data sources and start exploring your data with powerful business intelligence tools.</p>
            <div class="quick-actions">
              <button class="action-card" (click)="openConnectionModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 6h.01M6 18h.01m12-12h.01M18 18h.01M6 6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h2zM18 6a2 2 0 012 2v8a2 2 0 01-2 2h-2a2 2 0 01-2-2V8a2 2 0 012-2h2zM8 12h8"/>
                </svg>
                <div>
                  <h4>Connect Data Source</h4>
                  <p>SQL Server, PostgreSQL, or Excel</p>
                </div>
              </button>
              <button class="action-card" (click)="downloadTemplate()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <div>
                  <h4>Download Template</h4>
                  <p>Excel format with schema</p>
                </div>
              </button>
            </div>
          </div>
          
          <div *ngIf="isConnected" class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3>{{ tables.length }}</h3>
                <p>Tables Available</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3>{{ columns.length }}</h3>
                <p>Columns in Selected Table</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
              </div>
              <div class="stat-info">
                <h3>{{ tableData.length }}</h3>
                <p>Rows in Selected Table</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Metadata Tab -->
      <div *ngIf="activeTab === 'metadata'" class="tab-content">
        <div class="page-header">
          <h2>Database Metadata</h2>
          <p>Explore your database structure and relationships</p>
        </div>
        
        <div class="metadata-grid">
          <div class="metadata-card">
            <div class="card-header">
              <h3>Tables Overview</h3>
              <button (click)="loadTables()" class="btn-secondary" [disabled]="isLoading">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 4 23 10 17 10"/>
                  <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                </svg>
                Refresh
              </button>
            </div>
            <div class="table-list">
              <div *ngIf="tables.length === 0 && !isLoading" class="empty-state">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
                </svg>
                <p>No tables found</p>
                <span>Connect to a data source to view tables</span>
              </div>
              <div *ngFor="let table of tables" class="table-item" [class.selected]="selectedTable === table" (click)="selectTable(table)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
                </svg>
                <span>{{ table }}</span>
              </div>
            </div>
          </div>

          <div *ngIf="selectedTable && columns.length > 0" class="metadata-card">
            <div class="card-header">
              <h3>Schema: {{ selectedTable }}</h3>
            </div>
            <div class="table-wrapper">
              <table class="schema-table">
                <thead>
                  <tr>
                    <th>Column</th>
                    <th>Type</th>
                    <th>Length</th>
                    <th>Nullable</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let column of columns">
                    <td class="column-name">{{ column.column_name }}</td>
                    <td class="data-type">{{ column.data_type }}</td>
                    <td>{{ column.character_maximum_length || '-' }}</td>
                    <td>
                      <span class="nullable-badge" [class.yes]="column.is_nullable === 'YES'" [class.no]="column.is_nullable === 'NO'">
                        {{ column.is_nullable }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Tables Tab -->
      <div *ngIf="activeTab === 'tables'" class="tab-content">
        <div class="page-header">
          <h2>Table Data</h2>
          <p>Browse and explore your table data</p>
        </div>

        <div class="table-selector">
          <select [(ngModel)]="selectedTable" (change)="onTableSelected()" class="table-select">
            <option value="">Select a table...</option>
            <option *ngFor="let table of tables" [value]="table">{{ table }}</option>
          </select>
        </div>

        <div *ngIf="selectedTable && tableData.length > 0" class="data-viewer">
          <div class="data-header">
            <h3>{{ selectedTable }} Data</h3>
            <span class="row-count">{{ tableData.length }} rows</span>
          </div>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th *ngFor="let key of getObjectKeys(tableData[0])">{{ key }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of tableData; let i = index" [class.even]="i % 2 === 0">
                  <td *ngFor="let key of getObjectKeys(row)">{{ row[key] }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div *ngIf="selectedTable && tableData.length === 0" class="empty-state">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M9 3H5a2 2 0 00-2 2v4m6-6h10a2 2 0 012 2v4M9 3v18m0 0h10a2 2 0 002-2V9M9 21H5a2 2 0 01-2-2V9m0 0h18"/>
          </svg>
          <p>No data found</p>
          <span>The selected table appears to be empty</span>
        </div>
      </div>

      <!-- Query Tab -->
      <div *ngIf="activeTab === 'query'" class="tab-content">
        <div class="page-header">
          <h2>Query Builder</h2>
          <p>Execute custom SQL queries on your data</p>
        </div>

        <div class="query-builder">
          <div class="query-editor">
            <div class="editor-header">
              <h3>SQL Query</h3>
              <span class="help-text">Only SELECT queries are allowed</span>
            </div>
            <textarea 
              [(ngModel)]="customQuery" 
              placeholder="SELECT * FROM schema.table_name"
              class="query-textarea">
            </textarea>
            <div class="editor-actions">
              <button (click)="runCustomQuery()" [disabled]="!customQuery.trim() || isLoading" class="btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                Run Query
              </button>
              <button (click)="clearQuery()" class="btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                </svg>
                Clear
              </button>
            </div>
          </div>

          <div *ngIf="queryResults.length > 0" class="query-results">
            <div class="results-header">
              <h3>Query Results</h3>
              <span class="result-count">{{ queryResults.length }} rows returned</span>
            </div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th *ngFor="let key of getObjectKeys(queryResults[0])">{{ key }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of queryResults; let i = index" [class.even]="i % 2 === 0">
                    <td *ngFor="let key of getObjectKeys(row)">{{ row[key] }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div *ngIf="queryResults.length === 0 && customQuery.trim() && !isLoading" class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35"/>
            </svg>
            <p>No results found</p>
            <span>Your query returned no data</span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-content">
    <div class="footer-left">
      <span>&copy; 2025 AuroBi. All rights reserved.</span>
    </div>
    <div class="footer-right">
      <span>Business Intelligence Platform</span>
      <span>â€¢</span>
      <span>Version 1.0</span>
    </div>
  </div>
</footer>

<!-- Connection Modal -->
<div *ngIf="showConnectionModal" class="modal-overlay" (click)="closeConnectionModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Connect Data Source</h2>
      <button class="modal-close" (click)="closeConnectionModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="connection-tabs">
        <button class="tab-btn" [class.active]="connectionTab === 'sqlserver'" (click)="connectionTab = 'sqlserver'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
            <line x1="8" y1="21" x2="16" y2="21"/>
            <line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
          SQL Server
        </button>
        <button class="tab-btn" [class.active]="connectionTab === 'postgresql'" (click)="connectionTab = 'postgresql'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
            <line x1="8" y1="21" x2="16" y2="21"/>
            <line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
          PostgreSQL
        </button>
        <button class="tab-btn" [class.active]="connectionTab === 'excel'" (click)="connectionTab = 'excel'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          Excel Upload
        </button>
      </div>

      <div class="connection-content">
        <!-- SQL Server Tab -->
        <div *ngIf="connectionTab === 'sqlserver'" class="connection-form">
          <form [formGroup]="sqlServerForm" (ngSubmit)="connectToSqlServer()">
            <div class="form-row">
              <div class="form-group">
                <label for="sql-host">Host</label>
                <input type="text" id="sql-host" formControlName="host" placeholder="localhost">
              </div>
              <div class="form-group">
                <label for="sql-port">Port</label>
                <input type="number" id="sql-port" formControlName="port">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="sql-username">Username</label>
                <input type="text" id="sql-username" formControlName="username">
              </div>
              <div class="form-group">
                <label for="sql-password">Password</label>
                <input type="password" id="sql-password" formControlName="password">
              </div>
            </div>
            <div class="form-group">
              <label for="sql-database">Database</label>
              <input type="text" id="sql-database" formControlName="database">
            </div>
            <div class="form-actions">
              <button type="submit" [disabled]="sqlServerForm.invalid || isLoading" class="btn-primary">
                <svg *ngIf="!isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 6h.01M6 18h.01m12-12h.01M18 18h.01"/>
                </svg>
                <svg *ngIf="isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                {{ isLoading ? 'Connecting...' : 'Connect to SQL Server' }}
              </button>
            </div>
          </form>
        </div>

        <!-- PostgreSQL Tab -->
        <div *ngIf="connectionTab === 'postgresql'" class="connection-form">
          <form [formGroup]="postgresForm" (ngSubmit)="connectToPostgres()">
            <div class="form-row">
              <div class="form-group">
                <label for="pg-host">Host</label>
                <input type="text" id="pg-host" formControlName="host" placeholder="localhost">
              </div>
              <div class="form-group">
                <label for="pg-port">Port</label>
                <input type="number" id="pg-port" formControlName="port">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="pg-username">Username</label>
                <input type="text" id="pg-username" formControlName="username">
              </div>
              <div class="form-group">
                <label for="pg-password">Password</label>
                <input type="password" id="pg-password" formControlName="password">
              </div>
            </div>
            <div class="form-group">
              <label for="pg-database">Database</label>
              <input type="text" id="pg-database" formControlName="database">
            </div>
            <div class="form-actions">
              <button type="submit" [disabled]="postgresForm.invalid || isLoading" class="btn-primary">
                <svg *ngIf="!isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 6h.01M6 18h.01m12-12h.01M18 18h.01"/>
                </svg>
                <svg *ngIf="isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                {{ isLoading ? 'Connecting...' : 'Connect to PostgreSQL' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Excel Tab -->
        <div *ngIf="connectionTab === 'excel'" class="connection-form">
          <div class="file-upload">
            <div class="upload-area" [class.has-file]="selectedFile">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
              </svg>
              <div class="upload-text">
                <p *ngIf="!selectedFile">Drop your Excel file here or click to browse</p>
                <p *ngIf="selectedFile">{{ selectedFile.name }}</p>
              </div>
              <input type="file" (change)="onFileSelected($event)" accept=".xlsx,.xls" hidden #fileInput>
              <button type="button" (click)="fileInput.click()" class="browse-btn">Browse Files</button>
            </div>
            <div class="form-actions">
              <button (click)="uploadExcel()" [disabled]="!selectedFile || isLoading" class="btn-primary">
                <svg *ngIf="!isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <svg *ngIf="isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                {{ isLoading ? 'Uploading...' : 'Upload Excel' }}
              </button>
              <button (click)="downloadTemplate()" class="btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Download Template
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>